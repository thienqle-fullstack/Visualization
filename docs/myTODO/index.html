<!DOCTYPE html>
<html>
  <head>
    <meta charset='UTF-8'>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>


    <script src='https://unpkg.com/@remix-run/router@1.11.0/dist/router.umd.min.js'></script>
    <script src='https://unpkg.com/react-router@6.18.0/dist/umd/react-router.development.js'></script>
    <script src='https://unpkg.com/react-router-dom@6.18.0/dist/umd/react-router-dom.development.js'></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        body {
            height:100vh;
            background-color: #888;
        }

        ul.no-style li {
            list-style-type: none; 
            padding: 0;  
            margin: 0.5rem; 
        }

        .hidden {
            display: none;
        }

        ul.note-head li * {
            display: inline;
        }

        ul.note-head li:hover {
            background-color: yellow;
        }

        .my-modal {
            background-color: white;
            box-shadow: 1rem 1rem  0.5rem 0 rgba(0, 0, 0, 0.5);
            padding: 1rem;
        }
    </style>
   </head>
  <body>

    <div id="mydiv"></div>

    <script type="text/babel">

    var useContext = React.useContext;
    var useState = React.useState;
    var useCallback= React.useCallback;
    var createContext = React.createContext;
    var useEffect = React.useEffect;

    var useNavigate = ReactRouterDOM.useNavigate;
    
    

    const {Link,Route,Routes,HashRouter } = ReactRouterDOM

    const BrowserRouter= HashRouter;

    const MainContext = createContext()
    
    const Home = () => (
    <div className="container text-center">
        <h4>TODO application</h4>
        <h3>This application is similar to markdown language</h3>
        <p>Click here to <Link to="/edit">Edit</Link> your TODO</p>
    </div>
    )
    

    function List() { 
        
        const [notes,setNotes] = useContext(MainContext); //Global context state
        const [list,setList] = useState(notes.split('\n')); //Local State

        useEffect(() => {
               //Runs every on render
               //console.log("Get update if loading from localStorage")
               setList(notes.split('\n'))
        },[notes])

        return (           
                <>
                <button><Link to="/edit">Edit</Link></button>
                <div className="my-modal">
                <ul className="no-style note-head">
                    { 
                        //using map to iterate list, also catch index
                        list.map((note,index) => {
                            //Check and tranform data  
                            let item = note.split(' ')
                            let content = note
                            let first = item[0]
                            let last = item[item.length-1]!==null ? item[item.length-1] : ''
                            if(first.includes("#")) {
                                item.splice(0,1)
                            }
                            if(last.includes("#")) {
                                item.splice(length-1,1)
                            }
                            
                            let text = ''
                            text = item.join(' ')
                            switch(first) {
                                case '#': content = <h4>{text}</h4>; break;
                                case '##': content = <h4>{text}</h4>; break;
                                case '###': content = <h5>{text}</h5>; break;
                                default: content = <span>&nbsp; &nbsp;{text}</span>;
                            }
                            
                            switch(last) {
                                case '#r': content = <span style={{color: "red"}}>{content}</span>; break;
                                case '#g': content = <span style={{color: "green"}}>{content}</span>; break;
                                case '#b': content = <span style={{color: "blue"}}>{content}</span>; break;
                                case '#m': content = <span style={{color: "magenta"}}>{content}</span>; break;
                                case '#c': content = <span style={{color: "cyan"}}>{content}</span>; break;
                                case '#y': content = <span style={{color: "yellow"}}>{content}</span>; break;
                                case '#o': content = <span style={{color: "orange"}}>{content}</span>; break;
                                default: content = content;
                            }
                            
                            return (
                                <li key={index}>{content} <input className="float-end" type="checkbox"></input></li>
                            )
                        })
                    }
                </ul>
                </div>
                </>
        )
        
    }
        
        
    function TodoEditor()  {

        const [notes,setNotes] = useContext(MainContext);

        const navigate = useNavigate();
     
        const onSubmit = useCallback(() => {
            navigate("/list")
        },[notes])

        const onReset = useCallback(() => {
            setNotes("");
        },[notes])

        const onChange = useCallback((e) => {
            setNotes(e.target.value)
        },[])

        return (
            <>
            
            <label>Enter your notes:</label>
            <textarea 
                className="form-control" 
                rows="20"
                type="text" 
                value={notes}
                onChange={onChange}
                />
            <button onClick={onSubmit}>View</button>
            <button onClick={onReset}>Reset</button>
            </>
            )
    } 

      

      const App = () => {
        const [notes,setNotes] = useState('')

        const save = () => {
            localStorage.setItem('notes',notes)
        }

        const load = () => {
            const temp = localStorage.getItem('notes')
            if(temp!==null) {
                setNotes(temp);
            }
        }

        return (
            <MainContext.Provider value={[notes,setNotes]}>
                <BrowserRouter>
                    
                    <ul className="hidden">
                    <li><Link to="/">Home</Link></li>
                    <li><Link to="/list">List</Link></li>
                    <li><Link to="/edit">Edit</Link></li>
                    </ul>
                    <button onClick={load}>Load</button>
                    <button onClick={save}>Save</button>
                    <button><Link to="/">Home</Link></button>
                    <br/>
                    <br/>
                    <div className="container">
                    <Routes>
                        <Route path="/" exact element={<Home /> } />
                        <Route path="/list" element={<List /> } />
                        <Route path="/edit" element={<TodoEditor />} />
                    </Routes>
                    </div>
                </BrowserRouter>
          </MainContext.Provider>
        );
      }


      const container = document.getElementById('mydiv');
      const root = ReactDOM.createRoot(container);
      root.render(<App />)
      // ReactDOM.render(<App />, document.querySelector('#myDiv'));

      
    </script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>
</html>